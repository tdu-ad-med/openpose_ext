cmake_minimum_required(VERSION 3.10)
project(openpose_ext)
add_subdirectory(src)

# download openpose
set(LIBRARIES_PATH "${CMAKE_CURRENT_SOURCE_DIR}/3rdparty")
if (NOT EXISTS ${LIBRARIES_PATH})
	message(STATUS "create directory : ${LIBRARIES_PATH}")
	file(MAKE_DIRECTORY "${LIBRARIES_PATH}")
endif (NOT EXISTS ${LIBRARIES_PATH})
set(OPENPOSE_URL "https://github.com/CMU-Perceptual-Computing-Lab/openpose/releases/download/v1.5.1/openpose-1.5.1-binaries-win64-gpu-python-flir-3d_recommended.zip")
get_filename_component(OPENPOSE_ZIP_NAME "${OPENPOSE_URL}" NAME)
set(OPENPOSE_ZIP_PATH "${LIBRARIES_PATH}/${OPENPOSE_ZIP_NAME}")
if (NOT EXISTS ${OPENPOSE_ZIP_PATH})
	message(STATUS "download : ${OPENPOSE_URL}")
	file(DOWNLOAD "${OPENPOSE_URL}" "${OPENPOSE_ZIP_PATH}")
	message(STATUS "unzip : ${OPENPOSE_ZIP_PATH}")
	execute_process(COMMAND ${CMAKE_COMMAND} -E tar xf ${OPENPOSE_ZIP_PATH} WORKING_DIRECTORY ${LIBRARIES_PATH}) 
	set(OPENPOSE_MODELS_PATH "${LIBRARIES_PATH}/openpose-1.5.1-binaries-win64-gpu-python-flir-3d_recommended/openpose/models")
	set(OPENPOSE_MODELS_DOWNLOADER_PATH "${OPENPOSE_MODELS_PATH}/getModels.bat")
	execute_process(COMMAND ${OPENPOSE_MODELS_DOWNLOADER_PATH} WORKING_DIRECTORY ${OPENPOSE_MODELS_PATH})
endif (NOT EXISTS ${OPENPOSE_ZIP_PATH})
